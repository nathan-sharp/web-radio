<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Shuffle</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #282c34;
            color: #ffffff;
        }

        #player {
            text-align: center;
        }

        #current-song {
            margin: 20px 0;
            font-size: 1.5rem;
        }

        #next-song {
            margin: 20px 0;
            font-size: 1.5rem;
            position: absolute;
            bottom: 20px;
        }

        #progress-container {
            width: 100%;
            max-width: 500px;
            background-color: #444;
            border-radius: 5px;
            overflow: hidden;
            height: 10px;
            margin: 20px 0;
        }

        #progress-bar {
            height: 100%;
            background-color: #61dafb;
            width: 0;
            transition: width 0.1s;
        }

        #time {
            font-size: 1rem;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div id="player">
        <div id="current-song">Loading...</div>
        <div id="progress-container">
            <div id="progress-bar"></div>
        </div>
        <div id="time">0:00 / 0:00</div>
        <div id="next-song">Next: Loading...</div>
    </div>

    <script>
        async function fetchSongs() {
            try {
                const response = await fetch('songs.json');
                if (!response.ok) {
                    throw new Error('Failed to fetch song list');
                }
                return await response.json();
            } catch (error) {
                console.error('Error fetching songs:', error);
                return [];
            }
        }

        const audioPlayer = new Audio();
        const currentSongDisplay = document.getElementById('current-song');
        const nextSongDisplay = document.getElementById('next-song');
        const progressBar = document.getElementById('progress-bar');
        const progressContainer = document.getElementById('progress-container');
        const timeDisplay = document.getElementById('time');
        let songs = [];
        let nextSong = null;

        // Function to get a random song from the list
        function getRandomSong() {
            return songs[Math.floor(Math.random() * songs.length)];
        }

        // Function to format the song name (remove file extension)
        function formatSongName(song) {
            return song.replace(/\.[^/.]+$/, '');
        }

        // Function to play a new song
        function playRandomSong() {
            if (songs.length === 0) {
                currentSongDisplay.textContent = 'No songs available';
                nextSongDisplay.textContent = '';
                document.title = 'Music Shuffle';
                return;
            }
            const currentSong = nextSong || getRandomSong();
            nextSong = getRandomSong();

            audioPlayer.src = currentSong;
            audioPlayer.play();

            const formattedCurrentName = formatSongName(currentSong);
            const formattedNextName = formatSongName(nextSong);

            currentSongDisplay.textContent = formattedCurrentName;
            nextSongDisplay.textContent = `Next: ${formattedNextName}`;
            document.title = formattedCurrentName;
        }

        // Update progress bar and time display
        function updateProgress() {
            const { currentTime, duration } = audioPlayer;
            const progressPercent = (currentTime / duration) * 100;
            progressBar.style.width = `${progressPercent}%`;

            const formatTime = time => {
                const minutes = Math.floor(time / 60);
                const seconds = Math.floor(time % 60).toString().padStart(2, '0');
                return `${minutes}:${seconds}`;
            };

            timeDisplay.textContent = `${formatTime(currentTime)} / ${formatTime(duration || 0)}`;
        }

        // Automatically play the next song when the current one ends
        audioPlayer.addEventListener('ended', playRandomSong);

        // Update progress bar periodically
        audioPlayer.addEventListener('timeupdate', updateProgress);

        // Fetch songs and initialize player
        fetchSongs().then(fetchedSongs => {
            songs = fetchedSongs;
            nextSong = getRandomSong();
            playRandomSong();
        });
    </script>
</body>
</html>
